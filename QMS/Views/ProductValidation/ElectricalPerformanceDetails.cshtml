@using QMS.Core.Models

@model ElectricalPerformanceViewModel

 
@{
    ViewData["Title"] = "Electrical Performance";

    int samples = 5;
    int rowsPerCondition = 9;

    string before = "Before Soaking";
    string after = "After 2 hrs Soaking";

    var dbRows = Model.Details ?? new List<ElectricalPerDetailsViewModal>();
    var rows = new List<ElectricalPerDetailsViewModal>();

    // Always create fixed rows (90 rows)
    for (int s = 1; s <= samples; s++)
    {
        foreach (var c in new[] { before, after })
        {
            for (int r = 1; r <= rowsPerCondition; r++)
            {
                var existing = dbRows.FirstOrDefault(x =>
                    x.SampleNo == s &&
                    x.ConditionType == c &&
                    x.RowNo == r
                );

                rows.Add(existing ?? new ElectricalPerDetailsViewModal
                {
                    ElId = Model.Id,
                    SampleNo = s,
                    ConditionType = c,
                    RowNo = r
                });
            }
        }
    }
}


<link href="~/css/fontawesome/styles.min.css" rel="stylesheet" />
<link href="~/css/tabulator/tabulator.min.css" rel="stylesheet" />
<link href="~/css/tabulator/tabulator_bootstrap4.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/litepicker/dist/css/litepicker.css" />

<script src="~/js/jquery.min.js"></script>
<script src="~/js/jquery.datatables.js"></script>

<script src="~/lib/bootstrap/dist/js/datatables.buttons.min.js"></script>
<script src="~/lib/bootstrap/dist/js/noty.min.js"></script>
<script src="~/lib/bootstrap/dist/js/popupAlert.js"></script>
<script src="~/lib/bootstrap/dist/js/jszip.min.js"></script>
<script src="~/lib/bootstrap/dist/js/buttons.html5.min.js"></script>
<script src="~/js/common.js"></script>
<script src="https://cdn.jsdelivr.net/npm/litepicker/dist/litepicker.js"></script>
<script src="https://cdn.jsdelivr.net/npm/litepicker/dist/plugins/ranges.js"></script>
<script type="text/javascript">
    

    const ROWS_PER_SECTION = 9;     // keep 9 by default
    const SAMPLE_COUNT = 5;         // keep 5 by default
    const COND_BEFORE = "Before Soaking";
    const COND_AFTER  = "After 2 hrs Soaking";
    let searchTimeout;
    // Your Edit Id
    const EL_ID = parseInt("@(Model?.Id ?? 0)", 10) || 0;

        $(document).ready(function () {
            

                const inputElement = $("#prodCode_Search");
                if (inputElement.length) {
                    // Attach the keydown event handler
                        inputElement.on('input', function (event) {
                        handleProdCodeSearch(event);
                    });
                }
        });

        function handleProdCodeSearch(event) {
            debugger
            const input = event.target;
            if (!input) return;

            let searchQuery = input.value.trim();

            // 🔴 Clear suggestions if less than 4 chars
            if (searchQuery.length < 4) {
                clearTimeout(searchTimeout);
                // optional: hide suggestion dropdown here
                // hideBisSuggestions();
                return;
            }

            // ✅ Take first 4 characters only
            const searchTerms = searchQuery.substring(0, 4);

            // 🟡 Debounce API call
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                pagedData = {}; // Clear cached data
                fetchProdCodeRelatedData(searchTerms, input);
            }, 300);
        }

           function fetchProdCodeRelatedData(productCatNo, inputField) {
               
                $.ajax({
                    url: '/Vendor/GetCodeSearch', // API endpoint
                    type: 'GET', // HTTP method
                    data: { search: productCatNo }, // Query parameters
                    dataType: 'json', // Expected response data type
                    success: function (data) {
                        if (data && data.length > 0) {
                            displayProdCodeSuggestions(data, inputField);
                        } else {
                            showDangerAlert('No data found for the entered Product Cat No.');
                        }
                    },
                    error: function (xhr, status, error) {
                        showDangerAlert('Error fetching data:', error);
                    }
                });
            }

            // Function to display suggestions in a dropdown
                function displayProdCodeSuggestions(data, inputField) {
                    // Remove any existing dropdown (if any)
                    removeExistingDropdown(inputField);

                    // Ensure parent can anchor absolute dropdown
                    const parent = inputField.parentElement;
                    if (getComputedStyle(parent).position === "static") {
                        parent.style.position = "relative";
                    }

                    const dropdown = document.createElement('div');
                    dropdown.className = 'suggestion-dropdown';
                    dropdown.style.position = 'absolute';
                    dropdown.style.top = (inputField.offsetTop + inputField.offsetHeight) + 'px';
                    dropdown.style.left = inputField.offsetLeft + 'px';
                    dropdown.style.backgroundColor = 'white';
                    dropdown.style.border = '1px solid #ccc';
                    dropdown.style.zIndex = 1000;
                    dropdown.style.overflowY = 'auto';
                    dropdown.style.maxHeight = '300px';
                    dropdown.style.width = inputField.offsetWidth + 'px';
                    dropdown.style.boxShadow = '0px 4px 6px rgba(0, 0, 0, 0.1)';

                    data.forEach(item => {
                        const code = (item.oldPart_No || "").toString().trim();
                        // change these keys as per your API response:
                        const desc = (item.description || item.prodDesc || item.prod_Desc || "").toString().trim();

                        const option = document.createElement('div');
                        option.className = 'suggestion-item';
                        option.textContent = desc ? `${code} | ${desc}` : code;
                        option.style.padding = '8px';
                        option.style.cursor = 'pointer';

                        option.addEventListener('mouseover', () => {
                            option.style.backgroundColor = '#4682B4';
                            option.style.color = '#fff';
                        });
                        option.addEventListener('mouseout', () => {
                            option.style.backgroundColor = '';
                            option.style.color = '';
                        });

                        option.addEventListener('click', () => {

                            const productCatRefInput = document.getElementById('ProductCatRef');
                            if (productCatRefInput) {
                                productCatRefInput.value = code ?? '';
                            }

                            const productDescInput = document.getElementById('ProductDescription');
                            if (productDescInput) {
                                productDescInput.value = desc ?? '';
                            }

                            // optional: also set search box to just code
                            const searchBox = document.getElementById('prodCode_Search');
                            if (searchBox) {
                                searchBox.value = code;
                            }

                            dropdown.remove();
                        });

                        dropdown.appendChild(option);
                    });

                    parent.appendChild(dropdown);
                }



            // Function to remove any existing dropdowns
            function removeExistingDropdown(inputField) {
                const existingDropdown = document.querySelector('.suggestion-dropdown');
                if (existingDropdown) {
                    existingDropdown.remove();
                }
            }

            // Remove dropdown on outside click
            document.addEventListener('click', function (e) {
                if (!e.target.closest('.suggestion-dropdown') && !e.target.closest('#prodCode_Search')) {
                    removeExistingDropdown();
                }
            });


            function saveElectricalPerformance() {

                // ================= HEADER =================
                var idVal = $('#Id').val();
                idVal = idVal ? parseInt(idVal) : 0;

                var model = {
                    Id: idVal,   // VERY IMPORTANT
                    ProductCatRef: $('#ProductCatRef').val(),
                    ProductDescription: $('#ProductDescription').val(),
                    ReportNo: $('#ReportNo').val(),
                    ReportDate: $('#ReportDate').val(),

                    LightSourceDetails: $('#LightSourceDetails').val(),
                    DriverDetails: $('#DriverDetails').val(),
                    PCBDetails: $('#PCBDetails').val(),
                    LEDCombinations: $('#LEDCombinations').val(),
                    BatchCode: $('#BatchCode').val(),
                    SensorDetails: $('#SensorDetails').val(),
                    LampDetails: $('#LampDetails').val(),
                    PKD: $('#PKD').val(),

                    OverallResult: $('#OverallResult').val(),
                    TestedByName: $('#TestedByName').val(),
                    VerifiedByName: $('#VerifiedByName').val(),

                    ElectricalDetails: ""
                };

                // ================= TABLE LOOP =================
                var rows = [];
                var map = {};

                $('input[name^="Details["]').each(function () {

                    var name = $(this).attr('name'); // Details[0].Vac
                    var match = name.match(/Details\[(\d+)\]\.(.+)/);
                    if (!match) return;

                    var index = match[1];
                    var field = match[2];
                    var value = $(this).val() || '';

                    if (!map[index]) map[index] = {};
                    map[index][field] = value;
                });

                Object.keys(map).sort(function (a, b) {
                    return a - b;
                }).forEach(function (i) {

                    var d = map[i];

                    var row =
                        (d.SampleNo || '') + '^' +
                        (d.ConditionType || '') + '^' +
                        (d.RowNo || '') + '^' +

                        (d.Vac || '') + '^' +
                        (d.IacA || '') + '^' +
                        (d.Wac || '') + '^' +
                        (d.PF || '') + '^' +
                        (d.ATHD || '') + '^' +

                        (d.Vdc || '') + '^' +
                        (d.IdcA || '') + '^' +
                        (d.Wdc || '') + '^' +
                        (d.Eff || '') + '^' +
                        (d.NoLoadV || '') + '^' +
                        (d.StartV || '') + '^' +

                        (d.Result || '');

                    rows.push(row);
                });

                model.ElectricalDetails = rows.join('~');

                // ================= AJAX =================
                $.ajax({
                    url: '/ProductValidation/InsertUpdateElectricalPerformanceDetails',
                    type: 'POST',
                    data: model,
                    success: function (res) {
                        if (model.Id > 0) {
                            showSuccessAlert("Updated Successfully.");
                        } else {
                            showSuccessAlert("Saved Successfully.");
                        }
                    },
                    error: function (xhr, status, error) {
                    Blockloaderhide();
                    showDangerAlert('Error saving data: ' + error);
                    }
                });
            }

</script>



<style>
    .nav-pills .nav-link {
        text-align: left;
        border-radius: 0;
        border-left: 4px solid transparent;
        font-weight: 500;
        width: 100%;
        padding: 12px;
        background-color: #fff;
        color: #333;
        margin-bottom: 4px;
    }

        .nav-pills .nav-link.active {
            background-color: #f4f3f8;
            border-left: 4px solid #645394;
            color: #645394;
            font-weight: bold;
        }

    .form-control {
        padding: 0 9px !important;
        border: 0;
        border-bottom: 1px solid #cccccc;
        border-radius: 0px;
    }

        .form-control:disabled, .form-control[readonly] {
            background-color: #fff !important;
        }

    label {
        margin-bottom: 0;
        margin-top: .3rem;
    }

    .form-group {
        margin-bottom: 0.5rem; /* Reduce space between each input group */
    }

    .custome-body {
        margin-bottom: -17px !important;
        padding: 0.75rem !important;
        margin-top: -17px !important;
    }

    .tabulator .tabulator-header .tabulator-col {
        font-size: 14px;
        background-color: #D6E4F0;
        font-weight: 600;
        border-right: 1px solid #ccc;
    }

    .tabulator-row .tabulator-cell {
        padding: 5px 5px;
        font-size: 14px;
        height: 30px;
    }

    .tabulator-cell:hover {
        color: #4682B4 !important;
        cursor: pointer !important;
        font-weight: bold;
    }

    .calendar-container {
        cursor: pointer;
        padding: 10px 15px;
        width: 100%;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        transition: background-color 0.3s, box-shadow 0.3s;
        gap: 8px;
    }

        .calendar-container:hover {
            background-color: #e3f2fd;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .calendar-container i.fa-calendar {
            color: #2196f3;
            font-size: 1.2em;
            padding-left: 20px;
        }

        .calendar-container span {
            color: #4682B4;
            margin: 0;
            font-size: 16px;
        }

    .container__predefined-ranges {
        font-size: 14px;
    }

    .month-item {
        font-size: 14px;
    }

    #observationTable {
        width: 100%;
        border-collapse: collapse;
    }

        #observationTable, #observationTable th, #observationTable td {
            border: 1px solid black;
        }

            #observationTable th {
                text-align: center;
            }

            #observationTable th {
                background-color: lightgray;
            }

            #observationTable td {
                padding: 5px;
            }

    .td-text-wrap {
        width: 150px;
        white-space: normal;
        word-break: break-word;
        overflow-wrap: break-word;
    }

    em {
        color: red;
        font-weight: 700;
    }
    /* === Excel-like sheet === */
    .sheet {
        border: 1px solid #000;
        border-radius: 2px;
        background: #fff;
        overflow: hidden;
        font-size: 14px;
    }

    .row-grid {
        display: grid;
        grid-template-columns: 2fr 4fr 2fr 4fr; /* Label | Input | Label | Input */
        border-top: 1px solid #000;
    }

        .row-grid:first-child {
            border-top: 0;
        }

    .cell {
        border-left: 1px solid #000;
        display: flex;
        align-items: center;
        padding: 6px 10px;
        gap: 8px;
    }

        .cell:first-child {
            border-left: 0;
        }

        .cell label {
            font-weight: 700;
            white-space: nowrap;
            margin: 0;
        }

        .cell em {
            color: #d00;
            font-style: normal;
            margin-left: 4px;
        }

        .cell .form-control {
            height: 32px;
            padding: 4px 8px;
        }

        /* Inputs stretch but keep label tight */
        .cell .input-wrap {
            flex: 1 1 auto;
            display: flex;
            align-items: center;
            min-width: 80px;
        }

    /* Responsive: stack to 1 label + 1 input per line */
    @@media (max-width: 992px) {
        .row-grid {
            grid-template-columns: 2fr 4fr;
        }

            .row-grid .cell:nth-child(3) {
                border-left: 0;
            }
        /* start new pair cleanly */
    }

    table.report {
        width: 100%;
        border-collapse: collapse; /* ensures no double lines */
        table-layout: fixed;
        background: #fff;
        border: 1px solid #444; /* overall table border */
    }

    .report th,
    .report td {
        border: 1px solid #444; /* add solid border to every cell */
        padding: 8px 10px;
        font-size: 14px;
        vertical-align: middle;
    }

    /* Header styles */
    .report thead th {
        background: #f6f7fb;
        font-weight: 700;
        text-align: center;
        border: 1px solid #444; /* ensure header line continuity */
    }

    .report thead .group {
        font-size: 15px;
        letter-spacing: .3px;
    }

    .report thead .red {
        color: #c1121f;
        white-space: nowrap;
    }

    /*     Column widths  */

    .w-sample {
        width: 80px;
    }

    .w-params {
        width: 150px;
    }

    .w-result {
        width: 150px;
    }

    .w-narrow {
        width: 90px;
    }

    /* Row labels
        .label {
            font-weight: 600;
            text-align: center;
            color: #4b5563;
        }

        /* Zebra striping for readability */
    tbody tr:nth-child(even) td {
        background: #fafbff;
    }

    /* Optional: make borders slightly darker on print */
    @@media print {
        .report th, .report td {
            border: 1px solid #000;
        }
    }

</style>

<div class="content">
    <div class="card">
        <div class="card-body d-flex justify-content-between align-items-center">
            <div>
                <b style="font-size: large; color: #4682B4;">Electrical Performance</b>
            </div>
            <div>
                <button type="button" class="btn btn-outline-success" onclick="saveElectricalPerformance()">
                    <i class="fas fa-save mr-2"></i> Save
                </button>
                <button id="backButton" class="btn btn-outline-primary" type="button"
                        onclick="location.href='@Url.Action("ElectricalPerformance", "ProductValidation")'">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
            </div>
        </div>
    </div>

    @* ✅ Use your exact action/controller name here *@
@using (Html.BeginForm("InsertUpdateElectricalPerformanceDetails", "ProductValidation", FormMethod.Post))
{
    @Html.AntiForgeryToken()
    @Html.HiddenFor(m => m.Id)

    <div class="card">
        <div class="card-body">

            <!-- ================= HEADER FIELDS ================= -->

			<div class="row-grid">
				<div class="cell"><label>Product Cat Ref :</label></div>
                    <!-- BIS Search Code -->
                    <div class="row">
                        <input type="text"
                               name="prodCode_Search"
                               id="prodCode_Search"
							   class="inline-input form-control col-md-3"
                               placeholder="Search Code"
                               aria-label="Search Code"
                               oninput="handleProdCodeSearch(this)"
                               style="text-transform: uppercase;width: 175px;" />

						<div>@Html.TextBoxFor(m => m.ProductCatRef, new { @class = "form-control" })</div>
					</div>

				<div class="cell"><label>Product Description :</label></div>
				<div class="cell">@Html.TextBoxFor(m => m.ProductDescription, new { @class = "form-control" })</div>
			</div>



            <div class="row-grid">
                <div class="cell"><label>Report No :</label></div>
                <div class="cell">@Html.TextBoxFor(m => m.ReportNo, new { @class = "form-control" })</div>

                <div class="cell"><label>Report Date :</label></div>
                <div class="cell">
                    @Html.TextBoxFor(m => m.ReportDate, "{0:yyyy-MM-dd}", new { @class = "form-control", type = "date" })
                </div>
            </div>



            <div class="row-grid">
                <div class="cell"><label>Light Source Details :</label></div>
                <div class="cell">@Html.TextBoxFor(m => m.LightSourceDetails, new { @class = "form-control" })</div>

                <div class="cell"><label>Driver Details :</label></div>
                <div class="cell">@Html.TextBoxFor(m => m.DriverDetails, new { @class = "form-control" })</div>
            </div>

            <div class="row-grid">
                <div class="cell"><label>PCB Details :</label></div>
                <div class="cell">@Html.TextBoxFor(m => m.PCBDetails, new { @class = "form-control" })</div>

                <div class="cell"><label>LED Combinations :</label></div>
                <div class="cell">@Html.TextBoxFor(m => m.LEDCombinations, new { @class = "form-control" })</div>
            </div>

            <div class="row-grid">
                <div class="cell"><label>Sensor Details :</label></div>
                <div class="cell">@Html.TextBoxFor(m => m.SensorDetails, new { @class = "form-control" })</div>

                <div class="cell"><label>Batch Code :</label></div>
                <div class="cell">@Html.TextBoxFor(m => m.BatchCode, new { @class = "form-control" })</div>
            </div>

            <div class="row-grid">
                <div class="cell"><label>Lamp Details :</label></div>
                <div class="cell">@Html.TextBoxFor(m => m.LampDetails, new { @class = "form-control" })</div>

                <div class="cell"><label>PKD :</label></div>
                <div class="cell">@Html.TextBoxFor(m => m.PKD, new { @class = "form-control" })</div>
            </div>

            <!-- ================= REPORT TABLE ================= -->
            <div class="row mt-3">
                <div class="col-12">

                        <table class="table table-bordered">
@*                             <thead>
                                <tr>
                                    <th rowspan="2">Sample</th>
                                    <th rowspan="2">Condition</th>
                                    <th colspan="5">INPUT</th>
                                    <th colspan="6">OUTPUT</th>
                                    <th rowspan="2">Result</th>
                                </tr>
                                <tr>
                                    <th>Vac</th>
                                    <th>Iac</th>
                                    <th>Wac</th>
                                    <th>PF</th>
                                    <th>ATHD</th>
                                    <th>Vdc</th>
                                    <th>Idc</th>
                                    <th>Wdc</th>
                                    <th>Eff</th>
                                    <th>NoLoad</th>
                                    <th>StartV</th>
                                </tr>
                            </thead> *@

                            <tbody>
                                @{
                                    int i = 0;

                                    for (int s = 1; s <= samples; s++)
                                    {
                                        int sampleRowSpan = rowsPerCondition * 2;

                                        <!-- REPEATED HEADER FOR EACH SAMPLE -->
                                        <tr class="table-secondary">
                                            <th rowspan="2">Sample</th>
                                            <th rowspan="2">Condition</th>
                                            <th colspan="5">INPUT</th>
                                            <th colspan="6">OUTPUT</th>
                                            <th rowspan="2">Result</th>
                                        </tr>
                                        <tr class="table-secondary">
                                            <th>Vac</th>
                                            <th>Iac</th>
                                            <th>Wac</th>
                                            <th>PF</th>
                                            <th>ATHD</th>
                                            <th>Vdc</th>
                                            <th>Idc</th>
                                            <th>Wdc</th>
                                            <th>Eff</th>
                                            <th>NoLoad</th>
                                            <th>StartV</th>
                                        </tr>

                                        <!-- FIRST ROW (Before) -->
                                        <tr>
                                            <td rowspan="@sampleRowSpan">@s</td>
                                            <td rowspan="@rowsPerCondition">@before</td>

                                            @Html.Hidden($"Details[{i}].ElId", rows[i].ElId)
                                            @Html.Hidden($"Details[{i}].SampleNo", rows[i].SampleNo)
                                            @Html.Hidden($"Details[{i}].ConditionType", rows[i].ConditionType)
                                            @Html.Hidden($"Details[{i}].RowNo", rows[i].RowNo)

                                            <td><input name="Details[@i].Vac" class="form-control" value="@rows[i].Vac" /></td>
                                            <td><input name="Details[@i].IacA" class="form-control" value="@rows[i].IacA" /></td>
                                            <td><input name="Details[@i].Wac" class="form-control" value="@rows[i].Wac" /></td>
                                            <td><input name="Details[@i].PF" class="form-control" value="@rows[i].PF" /></td>
                                            <td><input name="Details[@i].ATHD" class="form-control" value="@rows[i].ATHD" /></td>

                                            <td><input name="Details[@i].Vdc" class="form-control" value="@rows[i].Vdc" /></td>
                                            <td><input name="Details[@i].IdcA" class="form-control" value="@rows[i].IdcA" /></td>
                                            <td><input name="Details[@i].Wdc" class="form-control" value="@rows[i].Wdc" /></td>
                                            <td><input name="Details[@i].Eff" class="form-control" value="@rows[i].Eff" /></td>
                                            <td><input name="Details[@i].NoLoadV" class="form-control" value="@rows[i].NoLoadV" /></td>
                                            <td><input name="Details[@i].StartV" class="form-control" value="@rows[i].StartV" /></td>

                                            <td><input name="Details[@i].Result" class="form-control" value="@rows[i].Result" /></td>
                                        </tr>

                                        i++;

                                        <!-- Remaining rows (Before) -->
                                        for (int r = 2; r <= rowsPerCondition; r++)
                                        {
                                            <tr>
                                                @Html.Hidden($"Details[{i}].ElId", rows[i].ElId)
                                                @Html.Hidden($"Details[{i}].SampleNo", rows[i].SampleNo)
                                                @Html.Hidden($"Details[{i}].ConditionType", rows[i].ConditionType)
                                                @Html.Hidden($"Details[{i}].RowNo", rows[i].RowNo)

                                                <td><input name="Details[@i].Vac" class="form-control" value="@rows[i].Vac" /></td>
                                                <td><input name="Details[@i].IacA" class="form-control" value="@rows[i].IacA" /></td>
                                                <td><input name="Details[@i].Wac" class="form-control" value="@rows[i].Wac" /></td>
                                                <td><input name="Details[@i].PF" class="form-control" value="@rows[i].PF" /></td>
                                                <td><input name="Details[@i].ATHD" class="form-control" value="@rows[i].ATHD" /></td>

                                                <td><input name="Details[@i].Vdc" class="form-control" value="@rows[i].Vdc" /></td>
                                                <td><input name="Details[@i].IdcA" class="form-control" value="@rows[i].IdcA" /></td>
                                                <td><input name="Details[@i].Wdc" class="form-control" value="@rows[i].Wdc" /></td>
                                                <td><input name="Details[@i].Eff" class="form-control" value="@rows[i].Eff" /></td>
                                                <td><input name="Details[@i].NoLoadV" class="form-control" value="@rows[i].NoLoadV" /></td>
                                                <td><input name="Details[@i].StartV" class="form-control" value="@rows[i].StartV" /></td>

                                                <td><input name="Details[@i].Result" class="form-control" value="@rows[i].Result" /></td>
                                            </tr>
                                            i++;
                                        }

                                        <!-- FIRST ROW (After) -->
                                        <tr>
                                            <td rowspan="@rowsPerCondition">@after</td>

                                            @Html.Hidden($"Details[{i}].ElId", rows[i].ElId)
                                            @Html.Hidden($"Details[{i}].SampleNo", rows[i].SampleNo)
                                            @Html.Hidden($"Details[{i}].ConditionType", rows[i].ConditionType)
                                            @Html.Hidden($"Details[{i}].RowNo", rows[i].RowNo)

                                            <td><input name="Details[@i].Vac" class="form-control" value="@rows[i].Vac" /></td>
                                            <td><input name="Details[@i].IacA" class="form-control" value="@rows[i].IacA" /></td>
                                            <td><input name="Details[@i].Wac" class="form-control" value="@rows[i].Wac" /></td>
                                            <td><input name="Details[@i].PF" class="form-control" value="@rows[i].PF" /></td>
                                            <td><input name="Details[@i].ATHD" class="form-control" value="@rows[i].ATHD" /></td>

                                            <td><input name="Details[@i].Vdc" class="form-control" value="@rows[i].Vdc" /></td>
                                            <td><input name="Details[@i].IdcA" class="form-control" value="@rows[i].IdcA" /></td>
                                            <td><input name="Details[@i].Wdc" class="form-control" value="@rows[i].Wdc" /></td>
                                            <td><input name="Details[@i].Eff" class="form-control" value="@rows[i].Eff" /></td>
                                            <td><input name="Details[@i].NoLoadV" class="form-control" value="@rows[i].NoLoadV" /></td>
                                            <td><input name="Details[@i].StartV" class="form-control" value="@rows[i].StartV" /></td>

                                            <td><input name="Details[@i].Result" class="form-control" value="@rows[i].Result" /></td>
                                        </tr>

                                        i++;

                                        <!-- Remaining rows (After) -->
                                        for (int r = 2; r <= rowsPerCondition; r++)
                                        {
                                            <tr>
                                                @Html.Hidden($"Details[{i}].ElId", rows[i].ElId)
                                                @Html.Hidden($"Details[{i}].SampleNo", rows[i].SampleNo)
                                                @Html.Hidden($"Details[{i}].ConditionType", rows[i].ConditionType)
                                                @Html.Hidden($"Details[{i}].RowNo", rows[i].RowNo)

                                                <td><input name="Details[@i].Vac" class="form-control" value="@rows[i].Vac" /></td>
                                                <td><input name="Details[@i].IacA" class="form-control" value="@rows[i].IacA" /></td>
                                                <td><input name="Details[@i].Wac" class="form-control" value="@rows[i].Wac" /></td>
                                                <td><input name="Details[@i].PF" class="form-control" value="@rows[i].PF" /></td>
                                                <td><input name="Details[@i].ATHD" class="form-control" value="@rows[i].ATHD" /></td>

                                                <td><input name="Details[@i].Vdc" class="form-control" value="@rows[i].Vdc" /></td>
                                                <td><input name="Details[@i].IdcA" class="form-control" value="@rows[i].IdcA" /></td>
                                                <td><input name="Details[@i].Wdc" class="form-control" value="@rows[i].Wdc" /></td>
                                                <td><input name="Details[@i].Eff" class="form-control" value="@rows[i].Eff" /></td>
                                                <td><input name="Details[@i].NoLoadV" class="form-control" value="@rows[i].NoLoadV" /></td>
                                                <td><input name="Details[@i].StartV" class="form-control" value="@rows[i].StartV" /></td>

                                                <td><input name="Details[@i].Result" class="form-control" value="@rows[i].Result" /></td>
                                            </tr>
                                            i++;
                                        }
                                    }
                                }
                            </tbody>
                        </table>


                </div>
                </div>

                <!-- ================= FOOTER ================= -->
                <div class="row-grid mt-3">
                    <div class="cell"><label>Overall Result :</label></div>
                    <div class="cell">@Html.TextBoxFor(m => m.OverallResult, new { @class = "form-control" })</div>

                    <div class="cell"><label>Tested By :</label></div>
                    <div class="cell">@Html.TextBoxFor(m => m.TestedByName, new { @class = "form-control" })</div>
                </div>

                <div class="row-grid">
                    <div class="cell"><label>Verified By :</label></div>
                    <div class="cell">@Html.TextBoxFor(m => m.VerifiedByName, new { @class = "form-control" })</div>
                </div>



            </div>
        </div>

}
</div>



@section HideSidebar { }
