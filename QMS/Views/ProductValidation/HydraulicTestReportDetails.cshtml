@{
    ViewData["Title"] = "Hydraulic Test Report";
}

<style>
    .label-bold {
        font-weight: 700;
    }

    .req {
        color: red;
        margin-left: 2px;
    }

    .add-btn {
        border: 1.8px solid #1aa260;
        background: #ffffff;
        color: #1aa260;
        padding: 10px 38px;
        border-radius: 12px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        font-size: 18px;
        font-weight: 600;
        letter-spacing: 0.5px;
    }

        .add-btn:hover {
            background: #e9fbe9;
        }

    .photo-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
    }

        .photo-table th,
        .photo-table td {
            border: 1px solid #000;
            padding: 6px 8px;
            text-align: center;
            vertical-align: middle;
        }

    .photo-cell {
        height: 170px;
    }

    .pretty-result-select {
        width: 100%;
        padding: 8px 30px 8px 12px;
        border: none;
        border-bottom: 2px solid #cbd5e1; /* soft underline */
        background-color: #fff;
        font-size: 14px;
        color: #000;
        border-radius: 0 0 8px 8px; /* rounded bottom */
        appearance: none;
        background-image: url("data:image/svg+xml;utf8,<svg fill='gray' height='12' viewBox='0 0 20 20' width='12' xmlns='http://www.w3.org/2000/svg'><path d='M5.516 7.548l4.484 4.486 4.484-4.486L16 8.548l-6 6-6-6z'/></svg>");
        background-repeat: no-repeat;
        background-position: right 10px center;
        box-shadow: 0px 2px 3px rgba(0,0,0,0.08); /* soft bottom shadow */
        cursor: pointer;
    }

        .pretty-result-select:focus {
            outline: none;
            border-bottom-color: #4682B4; /* blue highlight */
        }



    .input-underline {
        border: none;
        border-bottom: 1.5px solid #000;
        width: 70%;
        padding: 2px 4px;
        outline: none;
        background: transparent;
        font-size: 14px;
    }

        .input-underline::placeholder {
            color: #999;
        }

        .input-underline:focus {
            border-bottom: 1.5px solid #4682B4;
        }

    .field-label {
        font-weight: 600;
        margin-right: 6px;
    }

    .req {
        color: #d00;
    }

    .header-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
        border: 1px solid #000;
        margin-bottom: 0px;
    }

        .header-table td {
            border: 1px solid #000;
            padding: 10px;
        }

    .inline-input,
    .inline-date {
        border: none;
        border-bottom: 1.5px solid #666;
        background: transparent;
        width: 70%;
        font-size: 14px;
        padding: 2px 4px;
        outline: none;
    }

        .inline-input:focus,
        .inline-date:focus {
            border-bottom-color: #4682B4;
        }
</style>

<div class="content">
    <div class="row">
        <div class="col-12">

            <!-- HEADER -->
            <div class="card shadow-sm mb-3" style="border-radius:8px; border:1px solid #ccc;">
                <div class="card-body d-flex justify-content-between align-items-center">

                    <div>
                        <b style="font-size:large; color:#4682B4;">
                            Hydraulic Test Report
                        </b>
                    </div>

                    <div>
                        <button id="saveHydraulicButton"
                                type="button"
                                onclick="saveHydraulicTest()"
                                class="btn btn-outline-success mr-2"
                                style="width:120px;">
                            <i class="fas fa-save mr-1"></i>Save
                        </button>

                        <a href='@Url.Action("HydraulicTestReport", "ProductValidation")'
                           class="btn btn-outline-primary"
                           style="width:120px;">
                            <i class="fas fa-arrow-left"></i> Back
                        </a>
                    </div>

                </div>
            </div>

            <!-- BASIC FORM TABLE -->
            <div class="card shadow-sm mb-3" style="border-radius:8px; border:1px solid #ccc;">
                <div class="card-body">

                    <table class="header-table">
                        <tbody>

                            <!-- ROW 1: Title -->
                            <tr>
                                <td colspan="4" style="text-align:center; font-weight:700; font-size:15px;">
                                    Hydraulic Test Pressure as per Design Docket
                                </td>
                            </tr>

                            <!-- ROW 2: Report No -->
                            <tr>
                                <td colspan="3"></td>
                                <td>
                                    <span class="label-bold">Report No<span class="req">*</span> :</span>
                                    <input type="text" class="input-underline" placeholder="Enter Report No" style="width:60%;" />
                                </td>
                            </tr>

                            <!-- ROW 3: Customer / Project Name & Date -->
                            <tr>
                                <td colspan="3">
                                    <span class="label-bold">Customer / Project Name<span class="req">*</span> :</span>
                                    <input type="text" class="input-underline" placeholder="Enter Customer / Project" style="width:65%;" />
                                </td>

                                <td>
                                    <span class="label-bold">Date<span class="req">*</span> :</span>
                                    <input type="date" class="input-underline" />
                                </td>
                            </tr>

                            <!-- ROW 4: Product Details -->
                            <tr>
                                <td>
                                    <span class="label-bold">Product Cat Ref :</span>
                                    <input type="text" class="input-underline" placeholder="Enter Ref" />
                                </td>

                                <td>
                                    <span class="label-bold">Product Description :</span>
                                    <input type="text" class="input-underline" placeholder="Enter Description" />
                                </td>

                                <td>
                                    <span class="label-bold">Batch Code :</span>
                                    <input type="text" class="input-underline" placeholder="Enter Batch Code" />
                                </td>

                                <td>
                                    <span class="label-bold">Quantity :</span>
                                    <input type="text" class="input-underline" placeholder="Enter Quantity" />
                                </td>
                            </tr>

                            <!-- Hydraulic Pressure (Not mandatory) -->
                            <tr>
                                <td colspan="4">
                                    <span class="label-bold">Hydraulic Test Pressure :</span>
                                    <input type="text" class="input-underline" placeholder="Enter Pressure" style="width:50%;" />
                                </td>
                            </tr>



                            <tr>
                                <td colspan="6" style="padding:12px; text-align:left;">
                                    <button id="addRowBtn" type="button" class="btn btn-outline-success" style="width:120px; font-size:15px; border-radius:6px;">
                                        <i class="fas fa-plus"></i> Add
                                    </button>
                                </td>
                            </tr>

                        </tbody>
                    </table>

                    <div class="table-responsive">
                        <table class="photo-table">
                            <thead>
                                <tr>
                                    <th style="width:5%;">Sr. No.</th>
                                    <th style="width:20%;">Photo Before Test</th>
                                    <th style="width:20%;">Photo After Test</th>
                                    <th style="width:25%;">Observation</th>
                                    <th style="color:red; width:15%;">Result ( Pass/ Fail )</th>
                                </tr>
                            </thead>

                            <tbody id="hydraulicPhotosTbody">
                                <tr class="test-row">
                                    <td style="width:8%; text-align:center;">
                                        <span class="srno-number">1</span>
                                        <button type="button" class="delete-row-btn"
                                                style="border:none; background:none; cursor:pointer; margin-left:6px;">
                                            <i class="fas fa-trash" style="color:#c0392b; font-size:16px;"></i>
                                        </button>
                                    </td>

                                    <td class="photo-cell">
                                        <input type="file" style="border:none; width:100%;" />
                                    </td>

                                    <td class="photo-cell">
                                        <input type="file" style="border:none; width:100%;" />
                                    </td>

                                    <td contenteditable="true"></td>

                                    <td>
                                        <select class="pretty-result-select">
                                            <option value="">Select</option>
                                            <option value="Pass">Pass</option>
                                            <option value="Fail">Fail</option>
                                        </select>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <!-- SEPARATE TABLE FOR RESULT + SIGNATURES -->
                        <table class="header-table" style="margin-top:0; width:100%;">
                            <tbody>

                                <!-- FINAL RESULT ROW -->
                                <tr>
                                    <td colspan="5" style="text-align:left; padding:12px;">
                                        <span class="label-bold" style="color:red;">Result ( Pass / Fail ) :</span>
                                        <select class="pretty-result-select" style="width:200px; margin-left:10px;">
                                            <option value="">Select</option>
                                            <option value="Pass">Pass</option>
                                            <option value="Fail">Fail</option>
                                        </select>
                                    </td>
                                </tr>

                                <!-- SIGNATURE ROW -->
                                <tr>
                                    <td colspan="3" style="padding:12px;">
                                        <span class="label-bold">Tested By :</span>
                                        <input type="text" class="input-underline" placeholder="Enter Name" style="width:60%;" />
                                    </td>

                                    <td colspan="2" style="padding:12px;">
                                        <span class="label-bold">Verified By :</span>
                                        <input type="text" class="input-underline" placeholder="Enter Name" style="width:60%;" />
                                    </td>
                                </tr>

                            </tbody>
                        </table>

                    </div>


                </div>
            </div>

        </div>
    </div>
</div>
<script>

    let hydraulicAddBtn;
    let hydraulicTbody;

    $(document).ready(function () {
        
        try { initElectricalTests(); } catch (e) { console.error(e); }
        try { initDimensions(); } catch (e) { console.error(e); }
        try { initHydraulicPhotos(); } catch (e) { console.error(e); }
    });

    function hydraulicRefreshSerials() {
        const rows = hydraulicTbody.querySelectorAll('tr.test-row');
        rows.forEach((tr, idx) => {
            const snSpan = tr.querySelector('.srno-number');
            if (snSpan) snSpan.textContent = idx + 1;
        });
    }

    function hydraulicAddRow() {
        const tr = document.createElement('tr');
        tr.className = 'test-row';

        tr.innerHTML = `
                <td style="width:8%; text-align:center;">
                    <span class="srno-number"></span>
                    <button type="button" class="delete-row-btn"
                            style="border:none; background:none; cursor:pointer; margin-left:6px;">
                        <i class="fas fa-trash" style="color:#c0392b; font-size:16px;"></i>
                    </button>
                </td>
                <td class="photo-cell">
                    <input type="file" style="border:none; width:100%;" />
                </td>
                <td class="photo-cell">
                    <input type="file" style="border:none; width:100%;" />
                </td>
                <td contenteditable="true"></td>
                <td>
                    <select class="pretty-result-select">
                        <option value="">Select</option>
                        <option value="Pass">Pass</option>
                        <option value="Fail">Fail</option>
                    </select>
                </td>
            `;

        hydraulicTbody.appendChild(tr);
        hydraulicRefreshSerials();
    }

    function initHydraulicPhotos() {
        hydraulicAddBtn = document.getElementById('addRowBtn');
        hydraulicTbody = document.getElementById('hydraulicPhotosTbody');

        if (!hydraulicAddBtn || !hydraulicTbody) {
            console.error('Add button or hydraulicPhotosTbody not found.');
            return;
        }

        // delegated delete handler
        hydraulicTbody.addEventListener('click', function (e) {
            const delBtn = e.target.closest('.delete-row-btn');
            if (!delBtn) return;

            const tr = delBtn.closest('tr.test-row');
            if (tr) tr.remove();
            hydraulicRefreshSerials();
        });

        hydraulicAddBtn.addEventListener('click', hydraulicAddRow);
        hydraulicRefreshSerials();
    }
</script>


@section HideSidebar { }

